server {
    listen       443 ssl;

    ssl_certificate     /etc/ssl/cert.pem;
    ssl_certificate_key /etc/ssl/privkey.pem;
    ssl_protocols       TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';

    server_name  localhost;
    client_max_body_size 50m;

    # This is where the repositories live on the server
    root /srv/git;

    location ~ (/.*) {
        auth_basic "git repos";
        auth_basic_user_file /etc/nginx/htpasswd;
        include       fastcgi_params;
        fastcgi_param SCRIPT_FILENAME     /usr/lib/git-core/git-http-backend;
        # export all repositories under GIT_PROJECT_ROOT
        fastcgi_param GIT_HTTP_EXPORT_ALL "";
        fastcgi_param GIT_PROJECT_ROOT    /srv/git;
        # Takes the capture group from location directive and gives git that
        fastcgi_param PATH_INFO           $1;
        fastcgi_param REMOTE_USER         $remote_user;
        # Pass the request to fastcgi
        fastcgi_pass  unix:/var/run/fcgiwrap.socket;
    }
}
